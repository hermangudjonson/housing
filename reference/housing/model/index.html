
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../load_prep/">
      
      
        <link rel="next" href="../utils/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.8">
    
    
      
        <title>model - Housing Library</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4b4a2bd9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#housing.model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Housing Library" class="md-header__button md-logo" aria-label="Housing Library" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Housing Library
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              model
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hermangudjonson/housing.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Housing Library" class="md-nav__button md-logo" aria-label="Housing Library" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Housing Library
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hermangudjonson/housing.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    housing
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            housing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../automl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    automl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../gpu_check/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gpu_check
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../lightgbm_tune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lightgbm_tune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../load_prep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    load_prep
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    model
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    model
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#housing.model" class="md-nav__link">
    model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy" class="md-nav__link">
    LGBMProxy
  </a>
  
    <nav class="md-nav" aria-label="LGBMProxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.callbacks" class="md-nav__link">
    callbacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.validation" class="md-nav__link">
    validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.estimator_" class="md-nav__link">
    estimator_
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.get_params" class="md-nav__link">
    get_params()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.set_params" class="md-nav__link">
    set_params()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.__getattr__" class="md-nav__link">
    __getattr__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_imputer" class="md-nav__link">
    get_imputer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_pca_step" class="md-nav__link">
    get_pca_step()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_pca_pipeline" class="md-nav__link">
    get_pca_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_gower_dist" class="md-nav__link">
    get_gower_dist()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_regressor" class="md-nav__link">
    get_regressor()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_reg_pipeline" class="md-nav__link">
    get_reg_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.fit_with_validation" class="md-nav__link">
    fit_with_validation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.cv_with_validation" class="md-nav__link">
    cv_with_validation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.lgbm_fit_metrics" class="md-nav__link">
    lgbm_fit_metrics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.common_cv_callbacks" class="md-nav__link">
    common_cv_callbacks()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#housing.model" class="md-nav__link">
    model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy" class="md-nav__link">
    LGBMProxy
  </a>
  
    <nav class="md-nav" aria-label="LGBMProxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.callbacks" class="md-nav__link">
    callbacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.validation" class="md-nav__link">
    validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.estimator_" class="md-nav__link">
    estimator_
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.get_params" class="md-nav__link">
    get_params()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.set_params" class="md-nav__link">
    set_params()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#housing.model.LGBMProxy.__getattr__" class="md-nav__link">
    __getattr__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_imputer" class="md-nav__link">
    get_imputer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_pca_step" class="md-nav__link">
    get_pca_step()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_pca_pipeline" class="md-nav__link">
    get_pca_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_gower_dist" class="md-nav__link">
    get_gower_dist()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_regressor" class="md-nav__link">
    get_regressor()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.get_reg_pipeline" class="md-nav__link">
    get_reg_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.fit_with_validation" class="md-nav__link">
    fit_with_validation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.cv_with_validation" class="md-nav__link">
    cv_with_validation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.lgbm_fit_metrics" class="md-nav__link">
    lgbm_fit_metrics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housing.model.common_cv_callbacks" class="md-nav__link">
    common_cv_callbacks()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>model</h1>

<div class="doc doc-object doc-module">



<a id="housing.model"></a>
  <div class="doc doc-contents first">
  
      <p>Routines for housing model generation and evaluation.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h3 id="housing.model.LGBMProxy" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">LGBMProxy</span>


</h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.RegressorMixin">RegressorMixin</span></code></p>

  
      <p>LightGBM wrapper that conforms to sklearn interface</p>
<p>specifically move callbacks and validation data to initialization
rather than needing to be passed during the call to fit itself.
Note catboost tries to JSON serialize all parameters (fails for dataframe)</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>callbacks</code></b>
            (<code>list</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>lightgbm fit callback functions</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>validation</code></b>
            (<code>tuple(X, y)</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>validation data, required to use early stopping</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>**params</code></b>
            (<code>optional</code>, default:
                <code>{}</code>
)
        –
        <div class="doc-md-description">
          <p>parameters to be passed to LGBMRegressor initialization</p>
        </div>
      </li>
  </ul>

            <details class="quote">
              <summary>Source code in <code>housing/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LGBMProxy</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">RegressorMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LightGBM wrapper that conforms to sklearn interface</span>

<span class="sd">    specifically move callbacks and validation data to initialization</span>
<span class="sd">    rather than needing to be passed during the call to fit itself.</span>
<span class="sd">    Note catboost tries to JSON serialize all parameters (fails for dataframe)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    callbacks : list, optional</span>
<span class="sd">        lightgbm fit callback functions</span>
<span class="sd">    validation : tuple (X, y), optional</span>
<span class="sd">        validation data, required to use early stopping</span>
<span class="sd">    **params : optional</span>
<span class="sd">        parameters to be passed to LGBMRegressor initialization</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">validation</span>
        <span class="c1"># lightgbm classifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">lgbm</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span> <span class="o">|</span> <span class="p">{</span>
            <span class="s2">&quot;callbacks&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">,</span>
            <span class="s2">&quot;validation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;callbacks&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;callbacks&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;validation&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;validation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eval_set</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">,</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>
            <span class="n">eval_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span> <span class="s2">&quot;training&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eval_set</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">eval_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">X</span><span class="p">,</span>
            <span class="n">y</span><span class="p">,</span>
            <span class="n">eval_set</span><span class="o">=</span><span class="n">eval_set</span><span class="p">,</span>
            <span class="n">eval_names</span><span class="o">=</span><span class="n">eval_names</span><span class="p">,</span>
            <span class="n">eval_metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># defaulting to training objective</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;dispatch other methods to estimator&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">




<h4 id="housing.model.LGBMProxy.callbacks" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">callbacks</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h4 id="housing.model.LGBMProxy.validation" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">validation</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">validation</span> <span class="o">=</span> <span class="n">validation</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h4 id="housing.model.LGBMProxy.estimator_" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">estimator_</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">estimator_</span> <span class="o">=</span> <span class="n">lgbm</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  </div>

</div>




<div class="doc doc-object doc-function">




<h4 id="housing.model.LGBMProxy.__init__" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">__init__</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">validation</span>
    <span class="c1"># lightgbm classifier</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">lgbm</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="housing.model.LGBMProxy.get_params" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_params</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span> <span class="o">|</span> <span class="p">{</span>
        <span class="s2">&quot;callbacks&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">,</span>
        <span class="s2">&quot;validation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="housing.model.LGBMProxy.set_params" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_params</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;callbacks&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;callbacks&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;validation&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;validation&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="housing.model.LGBMProxy.fit" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">fit</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">eval_set</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">,</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>
        <span class="n">eval_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span> <span class="s2">&quot;training&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eval_set</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">eval_names</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">eval_set</span><span class="o">=</span><span class="n">eval_set</span><span class="p">,</span>
        <span class="n">eval_names</span><span class="o">=</span><span class="n">eval_names</span><span class="p">,</span>
        <span class="n">eval_metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># defaulting to training objective</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="housing.model.LGBMProxy.__getattr__" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">__getattr__</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>dispatch other methods to estimator</p>

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;dispatch other methods to estimator&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h3 id="housing.model.get_imputer" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_imputer</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_imputer</span><span class="p">(</span><span class="n">impute_categoricals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Pipeline step to impute scaled and filtered data.</p>
<p>Data is ordinal encoded with missing indicators and scaled numeric after thsi step.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>impute_categoricals</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        –
        <div class="doc-md-description">
          <p>whether to impute categorical features or just encode missing, by default True</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="sklearn.pipeline.Pipeline">Pipeline</span></code>
        –
        <div class="doc-md-description">
          
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_imputer</span><span class="p">(</span><span class="n">impute_categoricals</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pipeline step to impute scaled and filtered data.</span>

<span class="sd">    Data is ordinal encoded with missing indicators and scaled numeric after thsi step.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    impute_categoricals : bool, optional</span>
<span class="sd">        whether to impute categorical features or just encode missing, by default True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pipeline</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">impute_categoricals</span><span class="p">:</span>
        <span class="c1"># ordinal encoding followed by categorical naive bayes impute</span>
        <span class="c1"># unknown categories are marked missing and imputed (catNB can&#39;t handle -1)</span>
        <span class="n">cat_impute</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
            <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;use_encoded_value&quot;</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
            <span class="n">IterativeImputer</span><span class="p">(</span>
                <span class="n">CategoricalNB</span><span class="p">(</span><span class="n">min_categories</span><span class="o">=</span><span class="mi">25</span><span class="p">),</span>
                <span class="n">initial_strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">,</span>
                <span class="n">add_indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">skip_complete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># ordinal encoding with unknown/missing encoded as -1</span>
        <span class="n">cat_impute</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span>
            <span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;use_encoded_value&quot;</span><span class="p">,</span>
            <span class="n">unknown_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">encoded_missing_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># cat_step contains names of original categorical and numeric column names</span>
    <span class="n">cat_step</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
        <span class="p">(</span><span class="n">cat_impute</span><span class="p">,</span> <span class="n">make_column_selector</span><span class="p">(</span><span class="n">dtype_include</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">make_column_selector</span><span class="p">(</span><span class="n">dtype_exclude</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)),</span>
        <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">num_step</span> <span class="o">=</span> <span class="n">make_union</span><span class="p">(</span>
        <span class="c1"># pass ordinal encoded categoricals</span>
        <span class="n">make_column_transformer</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">cat_step</span><span class="o">.</span><span class="n">transformers_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span>
            <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="c1"># impute numeric and pass missing indicators</span>
        <span class="n">make_pipeline</span><span class="p">(</span>
            <span class="n">make_column_transformer</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">OneHotEncoder</span><span class="p">(</span>
                        <span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;infrequent_if_exist&quot;</span><span class="p">,</span>
                        <span class="n">min_frequency</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                        <span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">cat_step</span><span class="o">.</span><span class="n">transformers_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span>
                <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">BayesianRidge</span><span class="p">(),</span> <span class="n">skip_complete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">make_column_transformer</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">cat_step</span><span class="o">.</span><span class="n">transformers_</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">make_column_selector</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;missingindicator*&quot;</span><span class="p">)),</span>
                <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span>
                <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># removes prefix append by feature union</span>
    <span class="n">fix_col_names</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">set_axis</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">cat_step</span><span class="p">,</span> <span class="n">num_step</span><span class="p">,</span> <span class="n">fix_col_names</span><span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span>
        <span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="housing.model.get_pca_step" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_pca_step</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_pca_step</span><span class="p">(</span><span class="n">ordinal_selector</span><span class="p">,</span> <span class="n">numeric_selector</span><span class="p">,</span> <span class="n">passthrough</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cat_n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Apply PCA transform to one-hot categoricals and numeric features.</p>
<p>Input is ordinal imputed data. Relies on selector funcs to identify
remaining ordinal columns and numeric columns. PCA applied separately
to categoricals and numeric and concatenated</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>ordinal_selector</code></b>
            (<code>Callable[[X], columns]</code>)
        –
        <div class="doc-md-description">
          
        </div>
      </li>
      <li class="field-body">
        <b><code>numeric_selector</code></b>
            (<code>Callable[[X], columns]</code>)
        –
        <div class="doc-md-description">
          
        </div>
      </li>
      <li class="field-body">
        <b><code>passthrough</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        –
        <div class="doc-md-description">
          <p>whether to concat input data to PCA output, by default True</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="sklearn.pipeline.Pipeline">Pipeline</span></code>
        –
        <div class="doc-md-description">
          
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pca_step</span><span class="p">(</span>
    <span class="n">ordinal_selector</span><span class="p">,</span>
    <span class="n">numeric_selector</span><span class="p">,</span>
    <span class="n">passthrough</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cat_n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">num_n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply PCA transform to one-hot categoricals and numeric features.</span>

<span class="sd">    Input is ordinal imputed data. Relies on selector funcs to identify</span>
<span class="sd">    remaining ordinal columns and numeric columns. PCA applied separately</span>
<span class="sd">    to categoricals and numeric and concatenated</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ordinal_selector : Callable[[X], columns]</span>
<span class="sd">    numeric_selector : Callable[[X], columns]</span>
<span class="sd">    passthrough : bool, optional</span>
<span class="sd">        whether to concat input data to PCA output, by default True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pipeline</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cat_pca</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
        <span class="n">make_column_transformer</span><span class="p">(</span>
            <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">ordinal_selector</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">numeric_selector</span><span class="p">),</span>
            <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span>
            <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">cat_n_components</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>

    <span class="n">num_pca</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
        <span class="n">make_column_transformer</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">numeric_selector</span><span class="p">),</span>
            <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span>
            <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">num_n_components</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>

    <span class="c1"># removes prefix append by feature union</span>
    <span class="c1"># slight trick to only remove prefix from passthrough data</span>
    <span class="n">fix_col_names</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">set_axis</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s2">&quot;orig__&quot;</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">union_steps</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;orig&quot;</span><span class="p">,</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">)]</span> <span class="k">if</span> <span class="n">passthrough</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">union_steps</span> <span class="o">+=</span> <span class="p">[(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">cat_pca</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">num_pca</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">FeatureUnion</span><span class="p">(</span><span class="n">union_steps</span><span class="p">),</span> <span class="n">fix_col_names</span><span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span>
        <span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="housing.model.get_pca_pipeline" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_pca_pipeline</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_pca_pipeline</span><span class="p">(</span><span class="n">cat_n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pca_pipeline</span><span class="p">(</span><span class="n">cat_n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># raw to PCs</span>
    <span class="c1"># near zero var, scale, impute, PCA</span>
    <span class="n">impute_step</span> <span class="o">=</span> <span class="n">get_imputer</span><span class="p">()</span>

    <span class="n">pca_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
        <span class="n">load_prep</span><span class="o">.</span><span class="n">preprocess_pipe</span><span class="p">(),</span>
        <span class="n">impute_step</span><span class="p">,</span>
        <span class="n">get_pca_step</span><span class="p">(</span>
            <span class="n">_get_ordinal_selector</span><span class="p">(</span><span class="n">impute_step</span><span class="p">),</span>
            <span class="n">_get_numeric_selector</span><span class="p">(</span><span class="n">impute_step</span><span class="p">),</span>
            <span class="n">passthrough</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">cat_n_components</span><span class="o">=</span><span class="n">cat_n_components</span><span class="p">,</span>
            <span class="n">num_n_components</span><span class="o">=</span><span class="n">num_n_components</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">pca_pipe</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="housing.model.get_gower_dist" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_gower_dist</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_gower_dist</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_gower_dist</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="c1"># near zero var, scale, impute</span>
    <span class="c1"># impute to one hot cats to dice</span>
    <span class="c1"># impute to numeric to range normalized manhattan</span>
    <span class="n">impute_step</span> <span class="o">=</span> <span class="n">get_imputer</span><span class="p">()</span>

    <span class="n">impute_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">load_prep</span><span class="o">.</span><span class="n">preprocess_pipe</span><span class="p">(),</span> <span class="n">impute_step</span><span class="p">)</span>

    <span class="c1"># one hot encode remaining ordinal features</span>
    <span class="n">impute_to_onehot</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
        <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">_get_ordinal_selector</span><span class="p">(</span><span class="n">impute_step</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">_get_numeric_selector</span><span class="p">(</span><span class="n">impute_step</span><span class="p">)),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span>
        <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>
    <span class="c1"># scale numeric to [0, 1]</span>
    <span class="n">impute_to_num</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
        <span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">_get_numeric_selector</span><span class="p">(</span><span class="n">impute_step</span><span class="p">)),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span>
        <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>

    <span class="n">X_imputed</span> <span class="o">=</span> <span class="n">impute_pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X_onehot</span> <span class="o">=</span> <span class="n">impute_to_onehot</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_imputed</span><span class="p">)</span>
    <span class="n">X_num</span> <span class="o">=</span> <span class="n">impute_to_num</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_imputed</span><span class="p">)</span>

    <span class="n">dice_dist</span> <span class="o">=</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">X_onehot</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;dice&quot;</span><span class="p">)</span>
    <span class="n">man_dist</span> <span class="o">=</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">X_num</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cityblock&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">X_num</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">dice_dist</span> <span class="o">+</span> <span class="n">man_dist</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="housing.model.get_regressor" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_regressor</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_regressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_regressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">params</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;passthrough&quot;</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="n">enet_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;l1_ratio&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">}</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">enet_params</span> <span class="o">|</span> <span class="n">params</span>
        <span class="k">return</span> <span class="n">ElasticNetCV</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;lightgbm&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">LGBMProxy</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;flaml&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">flaml</span><span class="o">.</span><span class="n">AutoML</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s1">&#39;autogluon&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">AGProxy</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unimplemented strategy </span><span class="si">{</span><span class="n">strategy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="housing.model.get_reg_pipeline" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_reg_pipeline</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_reg_pipeline</span><span class="p">(</span><span class="n">reg_strategy</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span><span class="p">,</span> <span class="n">reg_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">onehot_encode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_pca</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_reg_pipeline</span><span class="p">(</span>
    <span class="n">reg_strategy</span><span class="o">=</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span>
    <span class="n">reg_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">onehot_encode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">include_pca</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">as_category</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">reg_params</span> <span class="o">=</span> <span class="n">reg_params</span> <span class="k">if</span> <span class="n">reg_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="c1"># preprocess, impute, (optional) onehot, regressor</span>
    <span class="n">impute_step</span> <span class="o">=</span> <span class="n">get_imputer</span><span class="p">()</span>

    <span class="c1"># PCA step</span>
    <span class="n">pca_step</span> <span class="o">=</span> <span class="n">get_pca_step</span><span class="p">(</span>
        <span class="n">_get_ordinal_selector</span><span class="p">(</span><span class="n">impute_step</span><span class="p">),</span>
        <span class="n">_get_numeric_selector</span><span class="p">(</span><span class="n">impute_step</span><span class="p">),</span>
        <span class="n">passthrough</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># one hot encode remaining ordinal features</span>
    <span class="n">impute_to_onehot</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
        <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">_get_ordinal_selector</span><span class="p">(</span><span class="n">impute_step</span><span class="p">)),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span>
        <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>

    <span class="c1"># cast features to categorical before input to regressor</span>
    <span class="n">cast_categoricals</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">_get_numeric_selector</span><span class="p">(</span><span class="n">impute_step</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">make_column_selector</span><span class="p">(</span><span class="s2">&quot;.*pca.*&quot;</span><span class="p">)),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="n">FunctionTransformer</span><span class="p">(</span><span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)),</span>
        <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>

    <span class="n">reg_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;preprocess&quot;</span><span class="p">,</span> <span class="n">load_prep</span><span class="o">.</span><span class="n">preprocess_pipe</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;impute&quot;</span><span class="p">,</span> <span class="n">impute_step</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;PCA&quot;</span><span class="p">,</span> <span class="n">pca_step</span> <span class="k">if</span> <span class="n">include_pca</span> <span class="k">else</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">impute_to_onehot</span> <span class="k">if</span> <span class="n">onehot_encode</span> <span class="k">else</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;categoricals&quot;</span><span class="p">,</span> <span class="n">cast_categoricals</span> <span class="k">if</span> <span class="n">as_category</span> <span class="k">else</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;regressor&quot;</span><span class="p">,</span> <span class="n">get_regressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">reg_strategy</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">reg_params</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># since we are passing info between steps, we override clone</span>
    <span class="n">reg_pipe</span><span class="o">.</span><span class="n">__sklearn_clone__</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">get_reg_pipeline</span><span class="p">(</span>
        <span class="n">reg_strategy</span><span class="p">,</span> <span class="n">reg_params</span><span class="p">,</span> <span class="n">onehot_encode</span><span class="p">,</span> <span class="n">include_pca</span><span class="p">,</span> <span class="n">as_category</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">reg_pipe</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="housing.model.fit_with_validation" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">fit_with_validation</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">fit_with_validation</span><span class="p">(</span><span class="n">reg_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_valid</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>fit routine for regression pipeline.</p>
<p>fits first stages first in order to pass transformed
validation data to final classifier if necessary</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>reg_pipe</code></b>
            (<code><span title="sklearn.pipeline.Pipeline">Pipeline</span></code>)
        –
        <div class="doc-md-description">
          <p>multi-step pipeline with final step regressor</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>X_train</code></b>
            (<code>2D array_like</code>)
        –
        <div class="doc-md-description">
          
        </div>
      </li>
      <li class="field-body">
        <b><code>y_train</code></b>
            (<code>1D array_like</code>)
        –
        <div class="doc-md-description">
          
        </div>
      </li>
      <li class="field-body">
        <b><code>X_valid</code></b>
            (<code>2D array_like</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>validation data to be transformed and passed to regressor, by default None</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>y_valid</code></b>
            (<code>1D array_like</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>by default None</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b><code>reg_pipe</code></b> (            <code>(<span title="sklearn.pipeline.Pipeline">Pipeline</span>, fitted)</code>
)        –
        <div class="doc-md-description">
          
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit_with_validation</span><span class="p">(</span>
    <span class="n">reg_pipe</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">,</span>
    <span class="n">X_train</span><span class="p">,</span>
    <span class="n">y_train</span><span class="p">,</span>
    <span class="n">X_valid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y_valid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;fit routine for regression pipeline.</span>

<span class="sd">    fits first stages first in order to pass transformed</span>
<span class="sd">    validation data to final classifier if necessary</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    reg_pipe : Pipeline</span>
<span class="sd">        multi-step pipeline with final step regressor</span>
<span class="sd">    X_train : 2D array_like</span>
<span class="sd">    y_train : 1D array_like</span>
<span class="sd">    X_valid : 2D array_like, optional</span>
<span class="sd">        validation data to be transformed and passed to regressor, by default None</span>
<span class="sd">    y_valid : 1D array_like, optional</span>
<span class="sd">        by default None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    reg_pipe : Pipeline, fitted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">X_valid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># simple call to fit</span>
        <span class="k">return</span> <span class="n">reg_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="n">X_train_pre</span> <span class="o">=</span> <span class="n">reg_pipe</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">X_valid_pre</span> <span class="o">=</span> <span class="n">reg_pipe</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_valid</span><span class="p">)</span>

    <span class="c1"># last step has to accept validation as a param</span>
    <span class="n">reg_pipe</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">validation</span><span class="o">=</span><span class="p">(</span><span class="n">X_valid_pre</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">))</span>
    <span class="n">reg_pipe</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_pre</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">reg_pipe</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="housing.model.cv_with_validation" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">cv_with_validation</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">cv_with_validation</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Perform cross-validation while passing validation data to the estimator
in each fold.</p>
<p>estimator is fit using <code>fit_with_validation</code>, and is assumed to be a pipeline that
can accept a validation data parameter</p>
<p>return results dictionary with one key per callback</p>

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cv_with_validation</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform cross-validation while passing validation data to the estimator</span>
<span class="sd">    in each fold.</span>

<span class="sd">    estimator is fit using `fit_with_validation`, and is assumed to be a pipeline that</span>
<span class="sd">    can accept a validation data parameter</span>

<span class="sd">    return results dictionary with one key per callback</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">check_cv</span><span class="p">(</span><span class="n">cv</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">classifier</span><span class="o">=</span><span class="n">is_classifier</span><span class="p">(</span><span class="n">estimator</span><span class="p">))</span>
    <span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span> <span class="k">if</span> <span class="n">callbacks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;train_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">fold</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
        <span class="n">fold_estimator</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>
        <span class="c1"># form a dummy pipeline to make this compatible with single estimators</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">):</span>
            <span class="n">fold_estimator</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">fold_estimator</span><span class="p">)</span>

        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">_safe_split</span><span class="p">(</span><span class="n">fold_estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">train_idx</span><span class="p">)</span>
        <span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="n">_safe_split</span><span class="p">(</span>
            <span class="n">fold_estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">,</span> <span class="n">train_indices</span><span class="o">=</span><span class="n">train_idx</span>
        <span class="p">)</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;validation&quot;</span> <span class="ow">in</span> <span class="n">fold_estimator</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">():</span>
            <span class="c1"># pass validation data if validation param exists in final pipeline step</span>
            <span class="n">fit_with_validation</span><span class="p">(</span><span class="n">fold_estimator</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fit_with_validation</span><span class="p">(</span><span class="n">fold_estimator</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="n">fit_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;train_time&quot;</span><span class="p">][</span><span class="n">fold</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_time</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">):</span>
            <span class="c1"># revert back to single estimator for evaluation</span>
            <span class="n">fold_estimator</span> <span class="o">=</span> <span class="n">fold_estimator</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">fold</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span>
                <span class="n">fold</span><span class="o">=</span><span class="n">fold</span><span class="p">,</span>
                <span class="n">estimator</span><span class="o">=</span><span class="n">fold_estimator</span><span class="p">,</span>
                <span class="n">indices</span><span class="o">=</span><span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">),</span>
                <span class="n">train_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span>
                <span class="n">test_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">),</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="housing.model.lgbm_fit_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">lgbm_fit_metrics</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">lgbm_fit_metrics</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return fit metrics for fitted LightGBM model</p>

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">lgbm_fit_metrics</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return fit metrics for fitted LightGBM model&quot;&quot;&quot;</span>
    <span class="n">reg</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">[</span><span class="s2">&quot;regressor&quot;</span><span class="p">]</span>
    <span class="n">best_ntree</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">best_iteration_</span> <span class="k">if</span> <span class="n">reg</span><span class="o">.</span><span class="n">best_iteration_</span> <span class="k">else</span> <span class="n">reg</span><span class="o">.</span><span class="n">n_estimators</span>
    <span class="n">best_idx</span> <span class="o">=</span> <span class="n">best_ntree</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">lgbm_evals</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;train_&quot;</span> <span class="o">+</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">best_idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reg</span><span class="o">.</span><span class="n">evals_result_</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
        <span class="o">**</span><span class="p">{</span>
            <span class="s2">&quot;test_&quot;</span> <span class="o">+</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">best_idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reg</span><span class="o">.</span><span class="n">evals_result_</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;best_ntree&quot;</span><span class="p">:</span> <span class="n">best_ntree</span><span class="p">},</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lgbm_evals</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="housing.model.common_cv_callbacks" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">common_cv_callbacks</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">common_cv_callbacks</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Generates dictionary of common CV callback functions for cv_with_validation.</p>
<p>includes:
    - fitted estimator
    - fold indices
    - evaluation metrics on training data
    - evaluation metrics on test data
    - test predictions
    - test target data</p>

          <details class="quote">
            <summary>Source code in <code>housing/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">common_cv_callbacks</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates dictionary of common CV callback functions for cv_with_validation.</span>

<span class="sd">    includes:</span>
<span class="sd">        - fitted estimator</span>
<span class="sd">        - fold indices</span>
<span class="sd">        - evaluation metrics on training data</span>
<span class="sd">        - evaluation metrics on test data</span>
<span class="sd">        - test predictions</span>
<span class="sd">        - test target data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">callbacks</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;estimator&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">estimator</span><span class="p">,</span>
        <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">indices</span><span class="p">,</span>
        <span class="s2">&quot;eval_train&quot;</span><span class="p">:</span> <span class="n">_score_train</span><span class="p">,</span>
        <span class="s2">&quot;eval_test&quot;</span><span class="p">:</span> <span class="n">_score_test</span><span class="p">,</span>
        <span class="s2">&quot;predict_test&quot;</span><span class="p">:</span> <span class="n">_predict_test</span><span class="p">,</span>
        <span class="s2">&quot;y_test&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">callbacks</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.81fa17fe.min.js"></script>
      
    
  </body>
</html>